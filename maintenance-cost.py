import streamlit as st
import pandas as pd
import io

st.set_page_config(page_title="‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á", layout="wide")

# ============================================================
#  FACTOR TABLES ‚Äî OFFICIAL MANUAL (‡πÅ‡∏ö‡∏ö A)
# ============================================================

# -----------------------------
# ASPHALT FACTORS
# -----------------------------
X1_OPTIONS = {
    "AC + ‡∏´‡∏¥‡∏ô‡∏Ñ‡∏•‡∏∏‡∏Å": 0.00,
    "Surface Treatment + ‡∏´‡∏¥‡∏ô‡∏Ñ‡∏•‡∏∏‡∏Å": 0.50,
    "AC + Soil Aggregate": 0.50,
    "Surface Treatment + Soil Aggregate": 1.00,
}

X2_OPTIONS = {
    "CBR ‚â§ 2": 1.00,
    "CBR = 3": 0.75,
    "CBR = 4": 0.50,
    "CBR = 5": 0.25,
    "CBR ‚â• 6": 0.00,
}

X3_OPTIONS = {
    "‚â§ 500": 0.00,
    "501‚Äì600": 0.04,
    "601‚Äì700": 0.08,
    "701‚Äì800": 0.12,
    "801‚Äì900": 0.16,
    "901‚Äì1000": 0.20,
    "1001‚Äì1100": 0.24,
    "1101‚Äì1200": 0.29,
    "1201‚Äì1300": 0.33,
    "1301‚Äì1400": 0.37,
    "1401‚Äì1500": 0.41,
    "1501‚Äì1600": 0.45,
    "1601‚Äì1700": 0.49,
    "1701‚Äì1800": 0.53,
    "1801‚Äì1900": 0.57,
    "1901‚Äì2000": 0.61,
    "2001‚Äì2200": 0.69,
    "2201‚Äì2400": 0.78,
    "2401‚Äì2600": 0.86,
    "2601‚Äì2800": 0.94,
    "2801‚Äì3000": 1.02,
    "3001‚Äì3300": 1.14,
    "3301‚Äì3600": 1.27,
    "3601‚Äì3900": 1.37,
    "3901‚Äì4200": 1.51,
    "4201‚Äì4500": 1.64,
    "4501‚Äì4800": 1.76,
    "4801‚Äì5100": 1.88,
    "5101‚Äì5400": 2.00,
    "5401‚Äì5700": 2.13,
    "‚â• 5701": 2.25,
}

X5_MAP = {5.0: 0.00, 5.5: 0.02, 6.0: 0.05, 6.5: 0.10, 7.0: 0.19}
X6_MAP = {"‡∏£‡∏≤‡∏ö": 0.00, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô": 0.02, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤": 0.04, "‡πÄ‡∏Ç‡∏≤": 0.07}

Y2_SHOULDER_LATERITE = {
    0.50: 0.00,
    1.00: 0.00,
    1.50: 0.00,
    1.75: 0.00,
    2.00: 0.00,
    2.25: 0.02,
    2.50: 0.05,
}

Y3_MAP = {"‡∏£‡∏≤‡∏ö": 0.00, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô": 0.24, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤": 0.36, "‡πÄ‡∏Ç‡∏≤": 0.48}
Y4_MAP = {"‡∏£‡∏≤‡∏ö": 0.00, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô": 0.24, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤": 0.36, "‡πÄ‡∏Ç‡∏≤": 0.48}
Y6_MAP = {"‡∏£‡∏≤‡∏ö": 0.00, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô": 0.04, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤": 0.08, "‡πÄ‡∏Ç‡∏≤": 0.12}

# -----------------------------
# LATERITE FACTORS
# -----------------------------
A1_OPTIONS = {
    "‚â§ 100": 0.00,
    "101‚Äì150": 0.13,
    "151‚Äì200": 0.24,
    "201‚Äì250": 0.36,
    "251‚Äì300": 0.47,
    "301‚Äì350": 0.59,
    "351‚Äì400": 0.71,
    "‚â• 401": 0.95,
}

A3_MAP = {6.0: 0.00, 7.0: 0.17, 8.0: 0.33, 9.0: 0.55, 10.0: 0.67, 11.0: 0.84, 12.0: 1.00}
B1_MAP = {20: 0.00, 30: 0.08, 40: 0.13, 50: 0.21, 60: 0.24}
B2_MAP = {"‡∏£‡∏≤‡∏ö": 0.05, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô": 0.13, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤": 0.22, "‡πÄ‡∏Ç‡∏≤": 0.32}
B3_MAP = {"‡∏£‡∏≤‡∏ö": 0.00, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô": 0.40, "‡∏•‡∏π‡∏Å‡πÄ‡∏ô‡∏¥‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡∏≤": 0.60, "‡πÄ‡∏Ç‡∏≤": 0.80}

# -----------------------------
# CONCRETE FACTORS (OFFICIAL)
# -----------------------------
Z1_OPTIONS = {
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 1 (~1%)": 0.00,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 2 (~2%)": 0.25,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 3 (~3%)": 0.50,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 4 (~4%)": 0.75,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 5 (~5%)": 1.00,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 6 (~6%)": 1.30,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 7 (~7%)": 1.60,
    "‡∏î‡∏±‡∏ä‡∏ô‡∏µ 8 (~8‚Äì10%)": 2.00,
}

Z2_OPTIONS = {
    "CBR ‚â§ 2": 1.00,
    "CBR = 3": 0.75,
    "CBR = 4": 0.50,
    "CBR = 5": 0.25,
    "CBR ‚â• 6": 0.00,
}

Z3_OPTIONS = {
    "‚â§ 1,000": 0.00,
    "1,001‚Äì2,000": 0.20,
    "2,001‚Äì3,000": 0.30,
    "3,001‚Äì4,000": 0.50,
    "4,001‚Äì5,000": 0.75,
    "5,001‚Äì6,000": 1.00,
    "6,001‚Äì7,000": 1.25,
    "7,001‚Äì8,000": 1.50,
    "8,001‚Äì9,000": 1.75,
    "9,001‚Äì10,000": 2.00,
    "10,001‚Äì15,000": 2.50,
    "‚â• 15,001": 3.00,
}

Z4_MAP = {6.0: 0.00, 6.5: 0.08, 7.0: 0.17}

Y2_CONCRETE = {
    1: 0.00,
    2: 0.20,
    3: 0.40,
    4: 0.60,
    5: 1.10,
    6: 1.20,
    7: 1.30,
    8: 1.40,
}

# ============================================================
#  CALCULATION FUNCTIONS
# ============================================================

def calc_asphalt(f):
    return 1 + 0.5 * sum(f.values())

def calc_laterite(f):
    return 1 + 0.70 * (f["A1"] + f["A2"] + f["A3"]) + 0.30 * (f["B1"] + f["B2"] + f["B3"] + f["B4"])

def calc_concrete(f):
    return 1 + 0.5 * sum(f.values())

def calc_budget(K, distance, Km, Na):
    workload = K * distance
    budget = workload * Km * Na
    return workload, budget

# ============================================================
#  SESSION STATE
# ============================================================

if "records" not in st.session_state:
    st.session_state["records"] = []

# ============================================================
#  GLOBAL INPUTS
# ============================================================

st.title("üìò ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏õ‡∏Å‡∏ï‡∏¥‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á")

with st.sidebar:
    st.header("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á")
    route_id = st.text_input("‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç/‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á", "")
    Km = st.number_input("‡∏Ñ‡πà‡∏≤ Km ‡∏ß‡∏±‡∏™‡∏î‡∏∏", min_value=0.0, value=1.00)
    Na = st.number_input("‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (Na/Ns/Nc)", min_value=0.0, value=17200.0)

surface = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á", ["‡πÅ‡∏≠‡∏™‡∏ü‡∏±‡∏•‡∏ó‡πå", "‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏á", "‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï"])

st.markdown("---")

# ============================================================
#  ASPHALT UI
# ============================================================

if surface == "‡πÅ‡∏≠‡∏™‡∏ü‡∏±‡∏•‡∏ó‡πå":
    st.subheader("‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏≠‡∏™‡∏ü‡∏±‡∏•‡∏ó‡πå")

    distance = st.number_input("‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)", min_value=0.0, step=0.001, value=1.000)

    col1, col2 = st.columns(2)

    with col1:
        X1 = X1_OPTIONS[st.selectbox("X1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á + ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏≤‡∏á", list(X1_OPTIONS.keys()))]
        X2 = X2_OPTIONS[st.selectbox("X2 ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏î‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏° (CBR)", list(X2_OPTIONS.keys()))]
        X3 = X3_OPTIONS[st.selectbox("X3 ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏à‡∏£‡∏≤‡∏à‡∏£", list(X3_OPTIONS.keys()))]

        age = st.slider("X4 ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏õ‡∏µ)", 0, 20, 5)
        if age <= 3:
            X4 = 0.0
        else:
            X4 = 0.2 * min(age - 3, 9)

    with col2:
        width = st.select_slider("X5 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)", options=[5.0, 5.5, 6.0, 6.5, 7.0], value=6.5)
        X5 = X5_MAP[width]

        topo = st.selectbox("X6 ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®", list(X6_MAP.keys()))
        X6 = X6_MAP[topo]

        ROW = st.number_input("Y1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Ç‡∏ï‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)", value=40.0)
        if ROW <= 40:
            Y1 = 0.0
        elif ROW <= 60:
            Y1 = 0.10
        elif ROW <= 80:
            Y1 = 0.20
        else:
            Y1 = 0.30

        shoulder = st.select_slider("Y2 ‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏á (‡πÄ‡∏°‡∏ï‡∏£/‡∏Ç‡πâ‡∏≤‡∏á)", options=[0.5, 1.0, 1.5, 1.75, 2.0, 2.25, 2.5], value=2.0)
        Y2 = Y2_SHOULDER_LATERITE[shoulder]

    col3, col4 = st.columns(2)
    with col3:
        Y3 = Y3_MAP[st.selectbox("Y3 ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏™‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", list(Y3_MAP.keys()))]
        Y4 = Y4_MAP[st.selectbox("Y4 ‡∏á‡∏≤‡∏ô‡∏ó‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", list(Y4_MAP.keys()))]

    with col4:
        bridge = st.number_input("Y5 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏™‡∏∞‡∏û‡∏≤‡∏ô (‡∏°./‡∏Å‡∏°.)", value=0.0)
        if bridge <= 20:
            Y5 = 0.0
        elif bridge <= 25:
            Y5 = 0.02
        elif bridge <= 30:
            Y5 = 0.04
        else:
            Y5 = 0.06

        Y6 = Y6_MAP[st.selectbox("Y6 ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", list(Y6_MAP.keys()))]

    if st.button("‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏ß‡πÅ‡∏≠‡∏™‡∏ü‡∏±‡∏•‡∏ó‡πå"):
        f = dict(X1=X1, X2=X2, X3=X3, X4=X4, X5=X5, X6=X6,
                 Y1=Y1, Y2=Y2, Y3=Y3, Y4=Y4, Y5=Y5, Y6=Y6)

        K = calc_asphalt(f)
        workload, budget = calc_budget(K, distance, Km, Na)

        st.success(f"K = {K:.3f}")
        st.info(f"‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô = {workload:.3f} ‡∏´‡∏ô‡πà‡∏ß‡∏¢")
        st.warning(f"‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì = {budget:,.2f} ‡∏ö‡∏≤‡∏ó")

        st.session_state["records"].append({
            "‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á": route_id,
            "‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á": "‡πÅ‡∏≠‡∏™‡∏ü‡∏±‡∏•‡∏ó‡πå",
            "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡∏Å‡∏°.": distance,
            "K": round(K, 3),
            "‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢": round(workload, 3),
            "Km": Km,
            "Na/Ns/Nc": Na,
            "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ö‡∏≤‡∏ó": round(budget, 2),
        })

# ============================================================
#  LATERITE UI
# ============================================================

elif surface == "‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏á":
    st.subheader("‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏á")

    distance = st.number_input("‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)", min_value=0.0, step=0.001, value=1.000)

    col1, col2 = st.columns(2)

    with col1:
        A1 = A1_OPTIONS[st.selectbox("A1 ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏à‡∏£‡∏≤‡∏à‡∏£", list(A1_OPTIONS.keys()))]
        A2 = st.number_input("A2 ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏•‡∏°‡∏ü‡πâ‡∏≤‡∏≠‡∏≤‡∏Å‡∏≤‡∏® (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏ä‡πâ 0)", value=0.0)
        A3 = A3_MAP[st.select_slider("A3 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏±‡∏ô‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)", options=[6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0], value=7.0)]

    with col2:
        B1 = B1_MAP[st.select_slider("B1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Ç‡∏ï‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)", options=[20, 30, 40, 50, 60], value=30)]
        B2 = B2_MAP[st.selectbox("B2 ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏™‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", list(B2_MAP.keys()))]
        B3 = B3_MAP[st.selectbox("B3 ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", list(B3_MAP.keys()))]

        bridge = st.number_input("B4 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏™‡∏∞‡∏û‡∏≤‡∏ô (‡∏°./‡∏Å‡∏°.)", value=0.0)
        if bridge <= 20:
            B4 = 0.02
        elif bridge <= 21:
            B4 = 0.03
        elif bridge <= 22:
            B4 = 0.10
        elif bridge <= 23:
            B4 = 0.15
        elif bridge <= 24:
            B4 = 0.20
        elif bridge <= 25:
            B4 = 0.25
        elif bridge <= 26:
            B4 = 0.30
        elif bridge <= 27:
            B4 = 0.35
        elif bridge <= 28:
            B4 = 0.40
        elif bridge <= 29:
            B4 = 0.45
        else:
            B4 = 0.50

    if st.button("‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏ß‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏á"):
        f = dict(A1=A1, A2=A2, A3=A3, B1=B1, B2=B2, B3=B3, B4=B4)
        K = calc_laterite(f)
        workload, budget = calc_budget(K, distance, Km, Na)

        st.success(f"K = {K:.3f}")
        st.info(f"‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô = {workload:.3f} ‡∏´‡∏ô‡πà‡∏ß‡∏¢")
        st.warning(f"‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì = {budget:,.2f} ‡∏ö‡∏≤‡∏ó")

        st.session_state["records"].append({
            "‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á": route_id,
            "‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á": "‡∏•‡∏π‡∏Å‡∏£‡∏±‡∏á",
            "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡∏Å‡∏°.": distance,
            "K": round(K, 3),
            "‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢": round(workload, 3),
            "Km": Km
        # ============================================================
#  CONCRETE UI
# ============================================================

elif surface == "‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï":
    st.subheader("‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï")

    # ‚≠ê ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á ‚≠ê
    distance = st.number_input("‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)", min_value=0.0, step=0.001, value=1.000)

    col1, col2 = st.columns(2)

    with col1:
        Z1 = Z1_OPTIONS[st.selectbox("Z1 ‡∏™‡∏†‡∏≤‡∏û‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á", list(Z1_OPTIONS.keys()))]
        Z2 = Z2_OPTIONS[st.selectbox("Z2 ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏î‡∏¥‡∏ô‡∏Ñ‡∏±‡∏ô‡∏ó‡∏≤‡∏á (CBR)", list(Z2_OPTIONS.keys()))]
        Z3 = Z3_OPTIONS[st.selectbox("Z3 ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏à‡∏£‡∏≤‡∏à‡∏£ (‡∏ï‡πà‡∏≠ 2 ‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏£‡∏≤‡∏à‡∏£)", list(Z3_OPTIONS.keys()))]

        z4_w = st.select_slider("Z4 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)", options=[6.0, 6.5, 7.0], value=7.0)
        Z4 = Z4_MAP[z4_w]

    with col2:
        ROW = st.number_input("Y1 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Ç‡∏ï‡∏ó‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)", value=40.0)
        if ROW <= 40:
            Y1 = 0.0
        elif ROW <= 60:
            Y1 = 0.10
        elif ROW <= 80:
            Y1 = 0.20
        else:
            Y1 = 0.30

        y2_index = st.selectbox("Y2 ‡∏î‡∏£‡∏£‡∏ä‡∏ô‡∏µ‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï", list(Y2_CONCRETE.keys()))
        Y2 = Y2_CONCRETE[y2_index]

        Y3 = Y3_MAP[st.selectbox("Y3 ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏™‡∏á‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå", list(Y3_MAP.keys()))]
        Y4 = Y4_MAP[st.selectbox("Y4 ‡∏á‡∏≤‡∏ô‡∏ó‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", list(Y4_MAP.keys()))]

        bridge = st.number_input("Y5 ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏™‡∏∞‡∏û‡∏≤‡∏ô (‡∏°./‡∏Å‡∏°.)", value=0.0)
        if bridge <= 20:
            Y5 = 0.0
        elif bridge <= 25:
            Y5 = 0.02
        elif bridge <= 30:
            Y5 = 0.04
        else:
            Y5 = 0.06

        Y6 = Y6_MAP[st.selectbox("Y6 ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥", list(Y6_MAP.keys()))]

    # ‚≠ê ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï ‚≠ê
    if st.button("‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏¥‡∏ß‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï"):
        f = dict(
            Z1=Z1, Z2=Z2, Z3=Z3, Z4=Z4,
            Y1=Y1, Y2=Y2, Y3=Y3, Y4=Y4, Y5=Y5, Y6=Y6
        )

        K = calc_concrete(f)
        workload, budget = calc_budget(K, distance, Km, Na)

        st.success(f"K = {K:.3f}")
        st.info(f"‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô = {workload:.3f} ‡∏´‡∏ô‡πà‡∏ß‡∏¢")
        st.warning(f"‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì = {budget:,.2f} ‡∏ö‡∏≤‡∏ó")

        st.session_state["records"].append({
            "‡∏™‡∏≤‡∏¢‡∏ó‡∏≤‡∏á": route_id,
            "‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á": "‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï",
            "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ‡∏Å‡∏°.": distance,
            "K": round(K, 3),
            "‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢": round(workload, 3),
            "Km": Km,
            "Na/Ns/Nc": Na,
            "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ö‡∏≤‡∏ó": round(budget, 2),
        })
