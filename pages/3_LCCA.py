#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
================================================================================
‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (LCCA) - ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 2.1
Pavement Life-Cycle Cost Analysis Program
================================================================================
‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢: ‡∏£‡∏®.‡∏î‡∏£.‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏• ‡∏°‡∏µ‡∏ú‡∏• (Assoc. Prof. Dr. Ittipon Meepon)
‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏¢‡∏ò‡∏≤ 
‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ (KMUTNB)
Department of Civil Engineering Education
King Mongkut's University of Technology North Bangkok

‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á

‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 2.1:
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á
- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏≠‡∏á
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á JRCP (Jointed Reinforced Concrete Pavement)
- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ
- Upload Excel Template
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£

‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á:
1. Flexible Pavement (‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô/‡πÅ‡∏≠‡∏™‡∏ü‡∏±‡∏•‡∏ï‡πå)
2. JPCP - Jointed Plain Concrete Pavement (‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å)
3. JRCP - Jointed Reinforced Concrete Pavement (‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å)
4. CRCP - Continuously Reinforced Concrete Pavement (‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)
================================================================================
"""

import streamlit as st
import numpy as np
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from typing import Dict, List, Tuple, Optional
from dataclasses import dataclass, field
import json
import io
from datetime import datetime
import hashlib

# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Excel
try:
    import openpyxl
    OPENPYXL_AVAILABLE = True
except ImportError:
    OPENPYXL_AVAILABLE = False


# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Word
try:
    from docx import Document as WordDocument
    from docx.shared import Inches, Pt, Cm
    from docx.enum.text import WD_ALIGN_PARAGRAPH
    from docx.enum.table import WD_TABLE_ALIGNMENT
    from docx.oxml.ns import qn
    from docx.oxml import OxmlElement
    DOCX_AVAILABLE = True
except ImportError:
    DOCX_AVAILABLE = False

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
# set_page_config ‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏µ‡πà Home.py ‡πÅ‡∏•‡πâ‡∏ß

# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Data Structures)
# =============================================================================

@dataclass
class ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤:
    """‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤"""
    ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: str
    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: float  # ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.
    ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: int
    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà: int = 0  # 0 = ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß


@dataclass
class ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û:
    """‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û"""
    ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°: str
    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢: float  # ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.
    ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: int


@dataclass
class ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á:
    """‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á"""
    ‡∏ä‡∏∑‡πà‡∏≠: str
    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: str
    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á: float  # ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.
    ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤: List[‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤]
    ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û: List[‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û]
    ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å: float = 20.0
    ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: float = 1000.0  # ‡∏ï‡∏£.‡∏°.
    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤: float = 0.0  # ‡∏ã‡∏°. (0 = ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏)
    ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: bool = True


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏•‡∏±‡∏Å (Core Calculation Functions)
# =============================================================================

def ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô(‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: float, ‡∏õ‡∏µ: int, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: float) -> float:
    """
    ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Present Worth)
    ‡∏™‡∏π‡∏ï‡∏£: PW = FV √ó (1 + i)^(-n)
    """
    if ‡∏õ‡∏µ < 0 or ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î < 0:
        return 0.0
    pwf = (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** (-‡∏õ‡∏µ)
    return ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô * pwf


def ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ(pw: float, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: float, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: int) -> float:
    """
    ‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (EAC)
    ‡∏™‡∏π‡∏ï‡∏£: EAC = PW √ó [i(1+i)^N] / [(1+i)^N - 1]
    """
    if ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå <= 0 or ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î <= 0:
        return 0.0
    ‡∏ï‡∏±‡∏ß‡πÄ‡∏®‡∏© = ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î * (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    ‡∏ï‡∏±‡∏ß‡∏™‡πà‡∏ß‡∏ô = (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå - 1
    crf = ‡∏ï‡∏±‡∏ß‡πÄ‡∏®‡∏© / ‡∏ï‡∏±‡∏ß‡∏™‡πà‡∏ß‡∏ô
    return pw * crf


def ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å(
    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: float,
    ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: int,
    ‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: int,
    ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: int,
    ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å: float = 20.0
) -> float:
    """‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å‡πÇ‡∏î‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ Straight-Line Depreciation"""
    ‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ = ‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á - (‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå - ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)
    
    if ‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <= 0:
        return ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ * (‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å / 100.0)
    
    ‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏µ = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ * (1 - ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å/100.0) / ‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á
    ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ - ‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏õ‡∏µ * (‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå - ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)
    
    return max(‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å, ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ * ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å / 100.0)


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
# =============================================================================

def ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î(
    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á,
    ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: int,
    ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: float,
    ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å: bool = True
) -> pd.DataFrame:
    """
    ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
    
    Logic ‡πÅ‡∏ö‡∏ö C - ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≠‡∏ö‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û:
    - ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π (Rehabilitation) ‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà
    - ‡∏£‡∏≠‡∏ö‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π
    - ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡∏õ‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π
    """
    ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ = []
    ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    
    # ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û
    ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = sorted([‡∏ü.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ for ‡∏ü in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û if ‡∏ü.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ <= ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå])
    ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π_set = set(‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
    
    # ‡∏õ‡∏µ‡∏ó‡∏µ‡πà 0: ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á * ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.append({
        '‡∏õ‡∏µ': 0,
        '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô',
        '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á',
        '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á,
        '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô,
        '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW': 1.0,
        '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    })
    
    # ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ (‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π)
    for ‡∏ö‡∏≥‡∏£‡∏∏‡∏á in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤:
        if ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà > 0:
            # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤: [0, ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π1, ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π2, ..., ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå]
            ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ä‡πà‡∏ß‡∏á = [0] + ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            
            for idx, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á in enumerate(‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ä‡πà‡∏ß‡∏á):
                # ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ä‡πà‡∏ß‡∏á
                if idx + 1 < len(‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ä‡πà‡∏ß‡∏á):
                    ‡∏õ‡∏µ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ä‡πà‡∏ß‡∏á = ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ä‡πà‡∏ß‡∏á[idx + 1]
                else:
                    ‡∏õ‡∏µ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ä‡πà‡∏ß‡∏á = ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå + 1
                
                # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏µ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á + ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà)
                ‡∏õ‡∏µ = ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ä‡πà‡∏ß‡∏á + ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà
                while ‡∏õ‡∏µ < ‡∏õ‡∏µ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ä‡πà‡∏ß‡∏á and ‡∏õ‡∏µ <= ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
                    # ‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π
                    if ‡∏õ‡∏µ not in ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π_set:
                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô = ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ * ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                        pwf = (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** (-‡∏õ‡∏µ)
                        ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.append({
                            '‡∏õ‡∏µ': ‡∏õ‡∏µ,
                            '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                            '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': '‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤',
                            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢,
                            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô,
                            '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW': pwf,
                            '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô * pwf
                        })
                    ‡∏õ‡∏µ += ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà
        else:
            # ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÑ‡∏°‡πà‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≤‡∏°‡∏ñ‡πâ‡∏≤‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π)
            if ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô <= ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå and ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô not in ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π_set:
                ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô = ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ * ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                pwf = (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** (-‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)
                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.append({
                    '‡∏õ‡∏µ': ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô,
                    '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                    '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': '‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤',
                    '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢,
                    '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô,
                    '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW': pwf,
                    '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô * pwf
                })
    
    # ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û
    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á * ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ = 0
    
    for ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û:
        if ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ <= ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô = ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ * ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
            pwf = (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** (-‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)
            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.append({
                '‡∏õ‡∏µ': ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£,
                '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': '‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û',
                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢,
                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô,
                '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW': pwf,
                '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô * pwf
            })
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
            ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ = ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
    
    # ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å
    if ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å:
        # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á
        if 'Flexible' in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó or '‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô' in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:
            ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á = 15
        elif 'CRCP' in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:
            ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á = 25
        else:  # JPCP, JRCP
            ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á = 20
            
        sv = ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å(
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢, ‡∏õ‡∏µ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢, ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á,
            ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å
        )
        pwf = (1 + ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) ** (-‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)
        ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.append({
            '‡∏õ‡∏µ': ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå,
            '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å',
            '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å',
            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': -sv / ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà,
            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ': -sv,
            '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW': pwf,
            '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': -sv * pwf
        })
    
    df = pd.DataFrame(‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
    df = df.sort_values(['‡∏õ‡∏µ', '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°']).reset_index(drop=True)
    
    return df


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA
# =============================================================================

def ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå_LCCA(
    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: List[‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á],
    ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: int,
    ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: float,
    ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å: bool = True
) -> Tuple[pd.DataFrame, Dict[str, pd.DataFrame]]:
    """‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"""
    ‡∏™‡∏£‡∏∏‡∏õ_‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ = []
    ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î_dict = {}
    
    # ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ = [‡∏ó for ‡∏ó in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î if ‡∏ó.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô]
    
    for ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:
        cf_table = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å)
        ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î_dict[‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠] = cf_table
        
        # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏£‡∏ß‡∏°
        ‡∏£‡∏ß‡∏°_nominal = cf_table['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ'].sum()
        ‡∏£‡∏ß‡∏°_pw = cf_table['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum()
        eac = ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ(‡∏£‡∏ß‡∏°_pw, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)
        
        ‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á = cf_table[cf_table['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] == '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á']['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum()
        ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ = cf_table[cf_table['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] == '‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤']['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum()
        ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π = cf_table[cf_table['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] == '‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û']['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum()
        ‡∏ã‡∏≤‡∏Å = cf_table[cf_table['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] == '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å']['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum()
        
        # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö attribute ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = getattr(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤', 0.0)
        
        ‡∏™‡∏£‡∏∏‡∏õ_‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£.append({
            '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠,
            '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó,
            '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_‡∏ã‡∏°': ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤,
            '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà_‡∏ï‡∏£‡∏°': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà,
            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á_‡∏ï‡∏£‡∏°': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á,
            'PW_‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á': ‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á,
            'PW_‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤': ‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤,
            'PW_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û': ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π,
            'PW_‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å': ‡∏ã‡∏≤‡∏Å,
            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏£‡∏ß‡∏°': ‡∏£‡∏ß‡∏°_nominal,
            '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°': ‡∏£‡∏ß‡∏°_pw,
            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ': eac,
            '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏£‡∏°_‡∏ï‡πà‡∏≠‡∏õ‡∏µ': eac / ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
        })
    
    ‡∏™‡∏£‡∏∏‡∏õ_df = pd.DataFrame(‡∏™‡∏£‡∏∏‡∏õ_‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
    if len(‡∏™‡∏£‡∏∏‡∏õ_df) > 0:
        ‡∏™‡∏£‡∏∏‡∏õ_df['‡∏•‡∏≥‡∏î‡∏±‡∏ö'] = ‡∏™‡∏£‡∏∏‡∏õ_df['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°'].rank().astype(int)
        ‡∏™‡∏£‡∏∏‡∏õ_df = ‡∏™‡∏£‡∏∏‡∏õ_df.sort_values('‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°').reset_index(drop=True)
    
    return ‡∏™‡∏£‡∏∏‡∏õ_df, ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î_dict


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß
# =============================================================================

def ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß_‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î(
    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: List[‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á],
    ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: int,
    ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ê‡∏≤‡∏ô: float,
    ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á: float = 0.02,
    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î: int = 5,
    ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å: bool = True
) -> Tuple[pd.DataFrame, pd.DataFrame]:
    """‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î"""
    ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö = np.linspace(max(‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ê‡∏≤‡∏ô - ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á, 0.001), 
                              ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ê‡∏≤‡∏ô + ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏∏‡∏î)
    ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå = []
    
    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ = [‡∏ó for ‡∏ó in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î if ‡∏ó.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô]
    
    for ‡∏≠‡∏±‡∏ï‡∏£‡∏≤ in ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ó‡∏î‡∏™‡∏≠‡∏ö:
        for ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ:
            cf = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤, ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å)
            pw = cf['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum()
            ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå.append({
                '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î': ‡∏≠‡∏±‡∏ï‡∏£‡∏≤,
                '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î_%': f"{‡∏≠‡∏±‡∏ï‡∏£‡∏≤*100:.1f}%",
                '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠,
                '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': pw,
                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ': ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ(pw, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)
            })
    
    df = pd.DataFrame(‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå)
    pivot = df.pivot(index='‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î_%', columns='‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', values='‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô') if len(df) > 0 else pd.DataFrame()
    
    return df, pivot


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏£‡∏ß‡∏° JRCP)
# =============================================================================

def ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô() -> List[‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á]:
    """‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 4 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó"""
    
    # 1. ‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (Flexible Pavement)
    flexible = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á(
        ‡∏ä‡∏∑‡πà‡∏≠="‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (AC)",
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó="Flexible",
        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á=1800.0,
        ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("Seal Coating", 25.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=3, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=3),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î", 50.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=5, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=5),
        ],
        ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Overlay AC 50 ‡∏°‡∏°.", 450.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=12),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á AC ‡πÉ‡∏´‡∏°‡πà", 650.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=24),
        ],
        ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å=20.0,
        ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà=10000.0,
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤=15.0,
        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô=True
    )
    
    # 2. JPCP - Jointed Plain Concrete Pavement (‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å)
    jpcp = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á(
        ‡∏ä‡∏∑‡πà‡∏≠="JPCP",
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó="JPCP",
        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á=2800.0,
        ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("Seal Coating", 35.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=5, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=5),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î", 40.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=10, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=10),
        ],
        ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Diamond Grinding", 180.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=20),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Overlay AC 100 ‡∏°‡∏°.", 550.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=30),
        ],
        ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å=30.0,
        ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà=10000.0,
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤=30.0,
        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô=True
    )
    
    # 3. JRCP - Jointed Reinforced Concrete Pavement (‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å)
    jrcp = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á(
        ‡∏ä‡∏∑‡πà‡∏≠="JRCP",
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó="JRCP",
        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á=3000.0,
        ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("Seal Coating", 35.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=6, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=6),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î", 35.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=12, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=12),
        ],
        ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Diamond Grinding", 180.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=22),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Overlay AC 100 ‡∏°‡∏°.", 550.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=32),
        ],
        ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å=32.0,
        ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà=10000.0,
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤=25.0,
        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô=True
    )
    
    # 4. CRCP - Continuously Reinforced Concrete Pavement
    crcp = ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á(
        ‡∏ä‡∏∑‡πà‡∏≠="CRCP",
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó="CRCP",
        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á=3500.0,
        ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("Seal Coating", 15.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=8, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=8),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏∏‡∏î", 30.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=12, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=12),
        ],
        ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û=[
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Diamond Grinding", 180.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=25),
            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Overlay AC 100 ‡∏°‡∏°.", 550.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=35),
        ],
        ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å=35.0,
        ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà=10000.0,
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤=25.0,
        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô=True
    )
    
    return [flexible, jpcp, jrcp, crcp]


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô JSON Import/Export
# =============================================================================

def ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å_‡πÄ‡∏õ‡πá‡∏ô_dict(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á) -> dict:
    """‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Dictionary"""
    return {
        '‡∏ä‡∏∑‡πà‡∏≠': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠,
        '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó,
        '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á,
        '‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å,
        '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà': ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà,
        '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤': getattr(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤', 0.0),
        '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': getattr(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', True),
        '‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤': [
            {
                '‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': ‡∏°.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': ‡∏°.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢,
                '‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô': ‡∏°.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô,
                '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà': ‡∏°.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà
            }
            for ‡∏° in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤
        ],
        '‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û': [
            {
                '‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°': ‡∏ü.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢': ‡∏ü.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢,
                '‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£': ‡∏ü.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
            }
            for ‡∏ü in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û
        ]
    }


def dict_‡πÄ‡∏õ‡πá‡∏ô_‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å(data: dict) -> ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á:
    """‡πÅ‡∏õ‡∏•‡∏á Dictionary ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"""
    ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á = [
        ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤(
            ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°=‡∏°['‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'],
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢=‡∏°['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢'],
            ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=‡∏°['‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô'],
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=‡∏°['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà']
        )
        for ‡∏° in data['‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤']
    ]
    
    ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π = [
        ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û(
            ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°=‡∏ü['‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'],
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢=‡∏ü['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢'],
            ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=‡∏ü['‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£']
        )
        for ‡∏ü in data['‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û']
    ]
    
    return ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á(
        ‡∏ä‡∏∑‡πà‡∏≠=data['‡∏ä‡∏∑‡πà‡∏≠'],
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó=data['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'],
        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á=data['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á'],
        ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤=‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á,
        ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û=‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π,
        ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å=data.get('‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å', 20.0),
        ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà=data.get('‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà', 10000.0),
        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤=data.get('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤', 0.0),
        ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô=data.get('‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', True)
    )


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Word
# =============================================================================

def ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_Word(
    ‡∏™‡∏£‡∏∏‡∏õ: pd.DataFrame,
    ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î: Dict[str, pd.DataFrame],
    ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: int,
    ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: float,
    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: List[‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á],
    ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: str = "‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á"
) -> io.BytesIO:
    """‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô LCCA ‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Word"""
    
    doc = WordDocument()
    
    # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    style = doc.styles['Normal']
    style.font.name = 'TH Sarabun New'
    style.font.size = Pt(14)
    
    # ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
    title = doc.add_heading('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (LCCA)', level=0)
    title.alignment = WD_ALIGN_PARAGRAPH.CENTER
    
    # ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
    project_title = doc.add_heading(‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£, level=1)
    project_title.alignment = WD_ALIGN_PARAGRAPH.CENTER
    
    doc.add_paragraph()
    
    # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
    doc.add_heading('1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', level=1)
    doc.add_paragraph(f'‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: {‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£}')
    doc.add_paragraph(f'‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: {datetime.now().strftime("%d/%m/%Y %H:%M")}')
    doc.add_paragraph(f'‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: {‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå} ‡∏õ‡∏µ')
    doc.add_paragraph(f'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: {‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î*100:.1f}%')
    doc.add_paragraph(f'‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: {len(‡∏™‡∏£‡∏∏‡∏õ)} ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å')
    
    # ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    doc.add_heading('2. ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', level=1)
    
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    table1 = doc.add_table(rows=1, cols=5)
    table1.style = 'Table Grid'
    table1.alignment = WD_TABLE_ALIGNMENT.CENTER
    
    # ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    hdr_cells = table1.rows[0].cells
    headers1 = ['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡∏ã‡∏°.)', '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏£.‡∏°.)', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)']
    for i, header in enumerate(headers1):
        hdr_cells[i].text = header
        hdr_cells[i].paragraphs[0].runs[0].bold = True
    
    # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    for _, row in ‡∏™‡∏£‡∏∏‡∏õ.iterrows():
        row_cells = table1.add_row().cells
        row_cells[0].text = str(row['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'])
        row_cells[1].text = str(row['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á'])
        row_cells[2].text = f"{row['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_‡∏ã‡∏°']:.1f}"
        row_cells[3].text = f"{row['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà_‡∏ï‡∏£‡∏°']:,.0f}"
        row_cells[4].text = f"{row['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á_‡∏ï‡∏£‡∏°']:,.0f}"
    
    doc.add_paragraph()
    
    # ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    doc.add_heading('3. ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA', level=1)
    
    # ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    table2 = doc.add_table(rows=1, cols=5)
    table2.style = 'Table Grid'
    table2.alignment = WD_TABLE_ALIGNMENT.CENTER
    
    hdr_cells2 = table2.rows[0].cells
    headers2 = ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)', 'EAC (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°./‡∏õ‡∏µ)']
    for i, header in enumerate(headers2):
        hdr_cells2[i].text = header
        hdr_cells2[i].paragraphs[0].runs[0].bold = True
    
    for _, row in ‡∏™‡∏£‡∏∏‡∏õ.iterrows():
        row_cells = table2.add_row().cells
        row_cells[0].text = str(int(row['‡∏•‡∏≥‡∏î‡∏±‡∏ö']))
        row_cells[1].text = str(row['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'])
        row_cells[2].text = f"{row['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']:,.0f}"
        row_cells[3].text = f"{row['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ']:,.0f}"
        row_cells[4].text = f"{row['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏£‡∏°_‡∏ï‡πà‡∏≠‡∏õ‡∏µ']:,.2f}"
    
    doc.add_paragraph()
    
    # ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
    doc.add_heading('4. ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)', level=1)
    
    table3 = doc.add_table(rows=1, cols=6)
    table3.style = 'Table Grid'
    table3.alignment = WD_TABLE_ALIGNMENT.CENTER
    
    hdr_cells3 = table3.rows[0].cells
    headers3 = ['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)', '‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ (‡∏ö‡∏≤‡∏ó)', '‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û (‡∏ö‡∏≤‡∏ó)', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å (‡∏ö‡∏≤‡∏ó)', '‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)']
    for i, header in enumerate(headers3):
        hdr_cells3[i].text = header
        hdr_cells3[i].paragraphs[0].runs[0].bold = True
    
    for _, row in ‡∏™‡∏£‡∏∏‡∏õ.iterrows():
        row_cells = table3.add_row().cells
        row_cells[0].text = str(row['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'])
        row_cells[1].text = f"{row['PW_‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á']:,.0f}"
        row_cells[2].text = f"{row['PW_‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤']:,.0f}"
        row_cells[3].text = f"{row['PW_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û']:,.0f}"
        row_cells[4].text = f"{row['PW_‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å']:,.0f}"
        row_cells[5].text = f"{row['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']:,.0f}"
    
    doc.add_paragraph()
    
    # ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
    doc.add_heading('5. ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', level=1)
    
    ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ = ‡∏™‡∏£‡∏∏‡∏õ.iloc[0]
    doc.add_paragraph(f'‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: {‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞["‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"]}')
    doc.add_paragraph(f'‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°: {‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞["‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°"]:,.0f} ‡∏ö‡∏≤‡∏ó')
    doc.add_paragraph(f'‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (EAC): {‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞["‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ"]:,.0f} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ')
    
    if len(‡∏™‡∏£‡∏∏‡∏õ) > 1:
        doc.add_paragraph()
        doc.add_paragraph('‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô:')
        for idx in range(1, len(‡∏™‡∏£‡∏∏‡∏õ)):
            ‡∏≠‡∏∑‡πà‡∏ô = ‡∏™‡∏£‡∏∏‡∏õ.iloc[idx]
            ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á = ‡∏≠‡∏∑‡πà‡∏ô['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°'] - ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']
            ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ = (‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á / ‡∏≠‡∏∑‡πà‡∏ô['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']) * 100
            doc.add_paragraph(f'  - vs {‡∏≠‡∏∑‡πà‡∏ô["‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"]}: ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î {‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á:,.0f} ‡∏ö‡∏≤‡∏ó ({‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞:.1f}%)')
    
    # ===== ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏§‡∏©‡∏é‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏π‡∏ï‡∏£ =====
    doc.add_page_break()
    doc.add_heading('6. ‡∏ó‡∏§‡∏©‡∏é‡∏µ‡πÅ‡∏•‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì', level=1)
    
    # ‡∏ó‡∏§‡∏©‡∏é‡∏µ LCCA
    doc.add_heading('6.1 ‡∏ó‡∏§‡∏©‡∏é‡∏µ Life-Cycle Cost Analysis (LCCA)', level=2)
    doc.add_paragraph(
        '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (LCCA) ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏° '
        '‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÇ‡∏î‡∏¢‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ '
        '‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û ‡πÅ‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á '
        '‡πÇ‡∏î‡∏¢‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Present Worth) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô'
    )
    
    # ‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
    doc.add_heading('6.2 ‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Present Worth)', level=2)
    doc.add_paragraph('‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:')
    doc.add_paragraph('    PW = FV √ó (1 + i)^(-n)', style='Normal')
    doc.add_paragraph('‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà:')
    doc.add_paragraph('    PW = ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Present Worth)')
    doc.add_paragraph('    FV = ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (Future Value)')
    doc.add_paragraph(f'    i = ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î (Discount Rate) = {‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î*100:.1f}%')
    doc.add_paragraph('    n = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô')
    
    # ‡∏™‡∏π‡∏ï‡∏£ EAC
    doc.add_heading('6.3 ‡∏™‡∏π‡∏ï‡∏£‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (EAC)', level=2)
    doc.add_paragraph('‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏õ‡∏µ:')
    doc.add_paragraph('    EAC = PW √ó [i √ó (1 + i)^n] / [(1 + i)^n - 1]', style='Normal')
    doc.add_paragraph('‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà:')
    doc.add_paragraph('    EAC = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (Equivalent Annual Cost)')
    doc.add_paragraph('    PW = ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°')
    doc.add_paragraph(f'    i = ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î = {‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î*100:.1f}%')
    doc.add_paragraph(f'    n = ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå = {‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå} ‡∏õ‡∏µ')
    
    # ‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å
    doc.add_heading('6.4 ‡∏™‡∏π‡∏ï‡∏£‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å (Salvage Value)', level=2)
    doc.add_paragraph('‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:')
    doc.add_paragraph('    SV = C √ó (RUL / L) √ó (r / 100)', style='Normal')
    doc.add_paragraph('‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡πà:')
    doc.add_paragraph('    SV = ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å (Salvage Value)')
    doc.add_paragraph('    C = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢')
    doc.add_paragraph('    RUL = ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Remaining Useful Life)')
    doc.add_paragraph('    L = ‡∏≠‡∏≤‡∏¢‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á')
    doc.add_paragraph('    r = ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å (%)')
    
    # ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
    doc.add_paragraph()
    doc.add_paragraph('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô AASHTO ‡πÅ‡∏•‡∏∞ FHWA Life-Cycle Cost Analysis')
    
    # ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    doc.add_page_break()
    doc.add_heading('7. ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', level=1)
    
    for ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, cf_table in ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î.items():
        doc.add_heading(f'6.{list(‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î.keys()).index(‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)+1} {‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å}', level=2)
        
        # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
        table_cf = doc.add_table(rows=1, cols=5)
        table_cf.style = 'Table Grid'
        
        hdr_cf = table_cf.rows[0].cells
        headers_cf = ['‡∏õ‡∏µ', '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)', '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì PW', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)']
        for i, header in enumerate(headers_cf):
            hdr_cf[i].text = header
            hdr_cf[i].paragraphs[0].runs[0].bold = True
        
        for _, row in cf_table.iterrows():
            row_cells = table_cf.add_row().cells
            row_cells[0].text = str(int(row['‡∏õ‡∏µ']))
            row_cells[1].text = str(row['‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°'])
            row_cells[2].text = f"{row['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ']:,.0f}"
            row_cells[3].text = f"{row['‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW']:.4f}"
            row_cells[4].text = f"{row['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô']:,.0f}"
        
        # ‡∏£‡∏ß‡∏°
        row_total = table_cf.add_row().cells
        row_total[0].text = ''
        row_total[1].text = '‡∏£‡∏ß‡∏°'
        row_total[1].paragraphs[0].runs[0].bold = True
        row_total[2].text = f"{cf_table['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ'].sum():,.0f}"
        row_total[3].text = ''
        row_total[4].text = f"{cf_table['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum():,.0f}"
        row_total[4].paragraphs[0].runs[0].bold = True
        
        doc.add_paragraph()
    
    # Footer
    doc.add_paragraph()
    doc.add_paragraph('‚îÄ' * 50)
    doc.add_paragraph(f'‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: {‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£}')
    doc.add_paragraph('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢: ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA ‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á v2.1')
    doc.add_paragraph('‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏¢‡∏ò‡∏≤ ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡πÄ‡∏´‡∏ô‡∏∑‡∏≠')
    
    # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô BytesIO
    file_stream = io.BytesIO()
    doc.save(file_stream)
    file_stream.seek(0)
    
    return file_stream


# =============================================================================
# ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 9: Streamlit Application
# =============================================================================


# =============================================================================
# Excel Upload Functions
# =============================================================================

def ‡∏™‡∏£‡πâ‡∏≤‡∏á_excel_template() -> io.BytesIO:
    """‡∏™‡∏£‡πâ‡∏≤‡∏á Excel template ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà)"""
    
    if not OPENPYXL_AVAILABLE:
        return None
    
    from openpyxl import Workbook
    from openpyxl.styles import Font, PatternFill, Alignment, Border, Side
    from openpyxl.utils.dataframe import dataframe_to_rows
    from openpyxl.worksheet.datavalidation import DataValidation
    
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á workbook
    wb = Workbook()
    ws = wb.active
    ws.title = "Sheet1"  # ‚úÖ ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Sheet1 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡πà‡∏≤‡∏ô
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: Header ‡∏´‡∏•‡∏±‡∏Å ===
    ws['A1'] = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA (Life-Cycle Cost Analysis)'
    ws['A1'].font = Font(size=14, bold=True, color="FFFFFF")
    ws['A1'].fill = PatternFill(start_color="1F4E78", end_color="1F4E78", fill_type="solid")
    ws['A1'].alignment = Alignment(horizontal='center', vertical='center')
    ws.merge_cells('A1:D1')
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ ===
    ws['A2'] = 'üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 4-7 ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå ‚Üí ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°'
    ws['A2'].font = Font(size=10, italic=True, color="0070C0")
    ws.merge_cells('A2:D2')
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á ===
    headers = ['‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡∏ã‡∏°.)', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)']
    for col_num, header in enumerate(headers, 1):
        cell = ws.cell(row=3, column=col_num)
        cell.value = header
        cell.font = Font(bold=True, color="FFFFFF", size=11)
        cell.fill = PatternFill(start_color="4472C4", end_color="4472C4", fill_type="solid")
        cell.alignment = Alignment(horizontal='center', vertical='center', wrap_text=True)
        cell.border = Border(
            left=Side(style='thin'),
            right=Side(style='thin'),
            top=Side(style='thin'),
            bottom=Side(style='thin')
        )
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß ===
    data_rows = [
        ['AC', '‡∏•‡∏≤‡∏î‡∏¢‡∏≤‡∏á', '', ''],
        ['JPCP', '‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï', '', ''],
        ['JRCP', '‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï', '', ''],
        ['CRCP', '‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï', '', '']
    ]
    
    for row_idx, row_data in enumerate(data_rows, start=4):
        for col_idx, value in enumerate(row_data, start=1):
            cell = ws.cell(row=row_idx, column=col_idx)
            cell.value = value
            cell.alignment = Alignment(horizontal='center', vertical='center')
            cell.border = Border(
                left=Side(style='thin'),
                right=Side(style='thin'),
                top=Side(style='thin'),
                bottom=Side(style='thin')
            )
            
            # ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏•‡∏±‡∏ö
            if row_idx % 2 == 0:
                cell.fill = PatternFill(start_color="E7E6E6", end_color="E7E6E6", fill_type="solid")
            
            # ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå A ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á)
            if col_idx == 1:
                cell.fill = PatternFill(start_color="D9E1F2", end_color="D9E1F2", fill_type="solid")
                cell.font = Font(bold=True)
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: Data Validation ===
    # Dropdown ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå B)
    dv_type = DataValidation(type="list", formula1='"‡∏•‡∏≤‡∏î‡∏¢‡∏≤‡∏á,‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï"', allow_blank=False)
    dv_type.error = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£'
    dv_type.errorTitle = '‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
    ws.add_data_validation(dv_type)
    dv_type.add('B4:B7')
    
    # Validation ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå C) - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10-50
    dv_thick = DataValidation(type="decimal", operator="between", formula1=10, formula2=50, allow_blank=True)
    dv_thick.error = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10-50 ‡∏ã‡∏°.'
    dv_thick.errorTitle = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
    ws.add_data_validation(dv_thick)
    dv_thick.add('C4:C7')
    
    # Validation ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå D) - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ö‡∏ß‡∏Å
    dv_cost = DataValidation(type="decimal", operator="greaterThan", formula1=0, allow_blank=False)
    dv_cost.error = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0'
    dv_cost.errorTitle = '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'
    ws.add_data_validation(dv_cost)
    dv_cost.add('D4:D7')
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ===
    ws.column_dimensions['A'].width = 15
    ws.column_dimensions['B'].width = 22
    ws.column_dimensions['C'].width = 25
    ws.column_dimensions['D'].width = 32
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 8: ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏ñ‡∏ß ===
    ws.row_dimensions[1].height = 25
    ws.row_dimensions[3].height = 40
    
    # === ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 9: ‡πÄ‡∏û‡∏¥‡πà‡∏° Comments ===
    from openpyxl.comments import Comment
    
    ws['C4'].comment = Comment('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô 15, 25, 30 ‡∏ã‡∏°.', 'LCCA System')
    ws['D4'].comment = Comment('‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÄ‡∏ä‡πà‡∏ô 1800, 2500 ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.', 'LCCA System')
    
    # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå
    output = io.BytesIO()
    wb.save(output)
    output.seek(0)
    return output


def ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å_excel(uploaded_file) -> Dict[str, Dict]:
    """
    ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ upload (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡∏°‡πà + Error Handling)
    
    Returns:
        Dict mapping ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏° -> {‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó}
    """
    try:
        # === ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 1: ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô Excel ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ===
        if not uploaded_file.name.endswith(('.xlsx', '.xls')):
            st.error("‚ùå ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Excel (.xlsx ‡∏´‡∏£‡∏∑‡∏≠ .xls)")
            return {}
        
        # === ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 2: ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ===
        try:
            df = pd.read_excel(uploaded_file, sheet_name='Sheet1', header=2)
        except Exception as e:
            st.error(f"‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel: {str(e)}")
            st.info("üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ Template ‡∏ó‡∏µ‡πà‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°")
            return {}
        
        # === ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 3: ‡∏°‡∏µ columns ‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ===
        required_cols = ['‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡∏ã‡∏°.)', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)']
        missing_cols = [col for col in required_cols if col not in df.columns]
        
        if missing_cols:
            st.error(f"‚ùå ‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≤‡∏î‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå: {', '.join(missing_cols)}")
            st.info("üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
            return {}
        
        # === ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö 4: ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ===
        if len(df) == 0:
            st.error("‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 4-7")
            return {}
        
        # ‡πÅ‡∏°‡∏û‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°
        ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡∏û = {
            'AC': '‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (AC)',
            'JPCP': 'JPCP',
            'JRCP': 'JRCP',
            'CRCP': 'CRCP'
        }
        
        # ‡πÅ‡∏°‡∏û‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á
        ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏°‡∏û = {
            '‡∏•‡∏≤‡∏î‡∏¢‡∏≤‡∏á': 'Flexible',
            '‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï': 'JPCP',
        }
        
        # ‡∏™‡∏£‡πâ‡∏≤‡∏á dictionary
        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = {}
        errors = []
        warnings = []
        
        for idx, row in df.iterrows():
            # ‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á
            ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠ = str(row['‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á']).strip()
            
            # ‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á, NaN, ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å
            if ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠ in ['', 'nan', 'NaN', 'None']:
                continue
                
            if ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠ not in ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡∏û:
                # ‡πÅ‡∏ñ‡∏ß‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
                continue
            
            # === ‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ===
            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô_str = str(row['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)'])
            try:
                ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô = float(‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô_str.replace(',', ''))
                
                # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏•
                if ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô <= 0:
                    errors.append(f"{‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠}: ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 (‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: {‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô})")
                    continue
                elif ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô > 10000:
                    warnings.append(f"{‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠}: ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ({‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:,.0f} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)")
                
            except:
                errors.append(f"{‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠}: ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: '{‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô_str}')")
                continue
            
            # === ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ===
            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = None
            if '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡∏ã‡∏°.)' in row:
                ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_str = str(row['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (‡∏ã‡∏°.)'])
                try:
                    if ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_str not in ['', 'nan', 'NaN', '‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•']:
                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = float(‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_str.replace(',', ''))
                        
                        # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏•
                        if ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ < 10 or ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ > 50:
                            warnings.append(f"{‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠}: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ({‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤} ‡∏ã‡∏°.)")
                except:
                    warnings.append(f"{‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠}: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ('{‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_str}') - ‡∏Ç‡πâ‡∏≤‡∏°")
            
            # === ‡∏≠‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö) ===
            ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó = None
            if '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á' in row:
                ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó_str = str(row['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á']).strip()
                if ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó_str in ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏°‡∏û:
                    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó = ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÅ‡∏°‡∏û[‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó_str]
            
            # ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏°‡∏û
            ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏° = ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏°‡∏û.get(‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠, ‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡πà‡∏≠)
            
            # ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î[‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°] = {
                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô': ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô,
                '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤': ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤,
                '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
            }
        
        # === ‡πÅ‡∏™‡∏î‡∏á Errors ‡πÅ‡∏•‡∏∞ Warnings ===
        if errors:
            st.error("‚ùå ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:")
            for err in errors:
                st.write(f"  ‚Ä¢ {err}")
        
        if warnings:
            st.warning("‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:")
            for warn in warnings:
                st.write(f"  ‚Ä¢ {warn}")
        
        # === ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ ===
        if len(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) == 0:
            st.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")
            st.info("üí° ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0")
        
        return ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    
    except Exception as e:
        st.error(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏≤‡∏î‡∏Ñ‡∏¥‡∏î: {str(e)}")
        st.info("üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")
        return {}


def main():
    """Main Streamlit Application"""
    
    # ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å
    st.title("üõ£Ô∏è ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏•‡∏≠‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á (LCCA)")
    st.markdown("""
    **Life-Cycle Cost Analysis for Pavement Alternatives - Version 2.2**
    
    **‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢:** ‡∏£‡∏®.‡∏î‡∏£.‡∏≠‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏• ‡∏°‡∏µ‡∏ú‡∏• (Assoc. Prof. Dr. Ittipon Meepon)  
    ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏¢‡∏ò‡∏≤ ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡πÄ‡∏´‡∏ô‡∏∑‡∏≠  
    Department of Civil Engineering Education, KMUTNB
    
    ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á
    
    ‚ú® **v2.2:** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç JSON load ‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï, Reset ‡∏°‡∏µ Confirm, ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Auto-apply, ‡πÄ‡∏û‡∏¥‡πà‡∏° Loading spinner
    """)
    
    st.divider()
    
    # ==========================================================================
    # Initialize Session State
    # ==========================================================================
    if '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' not in st.session_state:
        st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô()
    if 'json_version' not in st.session_state:
        st.session_state['json_version'] = 0

    # ==========================================================================
    # ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô (Cost Structure / Maintenance Cost) ‚Äî ‡∏ñ‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏±‡∏ö
    # ==========================================================================
    has_cost  = 'cost_to_lcca' in st.session_state
    has_maint = 'maintenance_to_lcca' in st.session_state

    if has_cost or has_maint:
        st.warning("üì¨ **‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° Cost Pavement** ‚Äî ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ")

        if has_cost:
            cost_map = st.session_state['cost_to_lcca']

            # ----- ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° prefix: AC‚ÜíFlexible, JRCP/JPCP‚ÜíJPCP, CRCP‚ÜíCRCP -----
            groups = {
                'AC (Flexible)':   {},   # AC1, AC2 ...
                'JPCP/JRCP':       {},   # JRCP1, JRCP2, JPCP1 ...
                'CRCP':            {},   # CRCP1, CRCP2 ...
            }
            for key, info in cost_map.items():
                k = key.strip().upper()
                # ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á
                if isinstance(info, dict):
                    label = info.get('‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á', info.get('name', key))
                    cost_val = info.get('‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á', info.get('cost', info.get('cost_sqm', 0)))
                else:
                    label = key
                    cost_val = float(info)
                display = f"{key} ‚Äî {label} ({cost_val:,.0f} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)"

                if k.startswith('AC') or 'FLEXIBLE' in k:
                    groups['AC (Flexible)'][key] = {'display': display, 'info': info}
                elif 'CRCP' in k:
                    groups['CRCP'][key] = {'display': display, 'info': info}
                elif 'JRCP' in k or 'JPCP' in k:
                    groups['JPCP/JRCP'][key] = {'display': display, 'info': info}
                else:
                    groups['AC (Flexible)'][key] = {'display': display, 'info': info}

            # ----- ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á preview -----
            with st.expander("üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å Cost Pavement", expanded=False):
                preview_rows = []
                for k, v in cost_map.items():
                    if isinstance(v, dict):
                        preview_rows.append({
                            "‡∏£‡∏´‡∏±‡∏™": k,
                            "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á": v.get('‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á', v.get('name', k)),
                            "‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)": f"{v.get('‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á', v.get('cost', v.get('cost_sqm', 0))):,.2f}"
                        })
                    else:
                        preview_rows.append({"‡∏£‡∏´‡∏±‡∏™": k, "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á": k, "‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)": f"{float(v):,.2f}"})
                st.dataframe(preview_rows, use_container_width=True, hide_index=True)

            # ----- Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° 4 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å -----
            st.markdown("##### üîΩ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏ó‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó")
            st.caption("‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏´‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å \"‚Äî ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ ‚Äî\"")

            NO_SELECT = "‚Äî ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ ‚Äî"
            selections = {}   # group_name ‚Üí selected key

            # ‡πÅ‡∏°‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å LCCA 4 ‡∏ï‡∏±‡∏ß
            lcca_map = {
                'AC (Flexible)':  {'‡∏ä‡∏∑‡πà‡∏≠': '‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏¢‡∏∑‡∏î‡∏´‡∏¢‡∏∏‡πà‡∏ô (AC)', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': 'Flexible'},
                'JPCP/JRCP':      {'‡∏ä‡∏∑‡πà‡∏≠': 'JPCP',                 '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': 'JPCP'},
                'CRCP':           {'‡∏ä‡∏∑‡πà‡∏≠': 'CRCP',                 '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': 'CRCP'},
            }

            cols_sel = st.columns(3)
            for idx, (grp_name, items) in enumerate(groups.items()):
                with cols_sel[idx]:
                    if len(items) == 0:
                        st.info(f"**{grp_name}**: ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
                        selections[grp_name] = None
                    elif len(items) == 1:
                        # ‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        only_key = list(items.keys())[0]
                        st.success(f"**{grp_name}**")
                        st.write(f"‚úÖ {items[only_key]['display']}")
                        selections[grp_name] = only_key
                    else:
                        # ‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß ‚Üí ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                        options = [NO_SELECT] + [items[k]['display'] for k in items]
                        chosen = st.selectbox(
                            f"**{grp_name}**",
                            options=options,
                            index=1,  # default ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å
                            key=f"_cost_sel_{grp_name}"
                        )
                        if chosen == NO_SELECT:
                            selections[grp_name] = None
                        else:
                            # ‡∏´‡∏≤ key ‡∏à‡∏≤‡∏Å display
                            for k, v in items.items():
                                if v['display'] == chosen:
                                    selections[grp_name] = k
                                    break

        # ----- ‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ / ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò -----
        st.divider()
        col_accept, col_reject = st.columns(2)

        with col_accept:
            if st.button("‚úÖ ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ (4 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)", type="primary", use_container_width=True):
                updated = 0

                if has_cost:
                    cost_map = st.session_state.pop('cost_to_lcca')

                    for grp_name, sel_key in selections.items():
                        if sel_key is None:
                            continue
                        info = cost_map.get(sel_key)
                        if info is None:
                            continue

                        # ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å info
                        if isinstance(info, dict):
                            new_cost = info.get('‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á', info.get('cost', info.get('cost_sqm', 0)))
                            new_thick = info.get('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤', info.get('thickness', None))
                            new_area  = info.get('‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà', info.get('area', None))
                            new_name_suffix = info.get('‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á', info.get('name', sel_key))
                        else:
                            new_cost = float(info)
                            new_thick = None
                            new_area  = None
                            new_name_suffix = sel_key

                        if new_cost <= 0:
                            continue

                        # ‡∏´‡∏≤‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏•‡∏∏‡πà‡∏°
                        target_name = lcca_map[grp_name]['‡∏ä‡∏∑‡πà‡∏≠']
                        target_type = lcca_map[grp_name]['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó']

                        found = False
                        for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
                            if ‡∏ó.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó == target_type or ‡∏ó.‡∏ä‡∏∑‡πà‡∏≠ == target_name:
                                ‡∏ó.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á = float(new_cost)
                                if new_thick is not None:
                                    ‡∏ó.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = float(new_thick)
                                if new_area is not None:
                                    ‡∏ó.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà = float(new_area)
                                # ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤
                                ‡∏ó.‡∏ä‡∏∑‡πà‡∏≠ = f"{target_name} [{sel_key}]"
                                found = True
                                updated += 1
                                break

                        # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà match ‚Üí ‡∏Ç‡πâ‡∏≤‡∏° (‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)
                        if not found:
                            st.warning(f"‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å {target_name} ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")

                # ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                if has_maint:
                    maint_map = st.session_state.pop('maintenance_to_lcca')
                    for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
                        for mkey, cost_per_sqm_yr in maint_map.items():
                            if mkey.upper() in ‡∏ó.‡∏ä‡∏∑‡πà‡∏≠.upper():
                                existing_names = [m.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° for m in ‡∏ó.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤]
                                if "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏Å‡∏ó‡∏ä.)" not in existing_names:
                                    ‡∏ó.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤.append(‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤(
                                        ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°="‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏Å‡∏ó‡∏ä.)",
                                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢=cost_per_sqm_yr,
                                        ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=1, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=1
                                    ))
                                else:
                                    for m in ‡∏ó.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤:
                                        if m.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° == "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏Å‡∏ó‡∏ä.)":
                                            m.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ = cost_per_sqm_yr
                                break

                if updated > 0:
                    st.session_state['_import_msg'] = f"‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à {updated} ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
                else:
                    st.session_state['_import_msg'] = "‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏î‡πâ"

                st.session_state['json_version'] += 1
                st.rerun()

        with col_reject:
            if st.button("‚ùå ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ", use_container_width=True):
                st.session_state.pop('cost_to_lcca', None)
                st.session_state.pop('maintenance_to_lcca', None)
                st.rerun()

        st.divider()

    # ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏´‡∏•‡∏±‡∏á rerun)
    if '_import_msg' in st.session_state:
        msg = st.session_state.pop('_import_msg')
        if msg.startswith('‚úÖ'):
            st.success(msg)
        else:
            st.warning(msg)

    # ==========================================================================
    # Sidebar: ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    # ==========================================================================
    with st.sidebar:
        st.header("‚öôÔ∏è ‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå")
        
        # ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
        if '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£' not in st.session_state:
            st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ = "‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á"
        
        # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ key= ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á conflict ‡πÄ‡∏°‡∏∑‡πà‡∏≠ JSON load ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô session_state
        # ‡πÉ‡∏ä‡πâ value=session_state ‡πÅ‡∏ó‡∏ô ‚Üí Streamlit ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å rerun ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ = st.text_input(
            "üèóÔ∏è ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
            value=st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£,
            help="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô"
        )
        st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ = ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
        
        st.divider()
        
        ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå = st.slider(
            "‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå (‡∏õ‡∏µ)",
            min_value=20, max_value=50, value=35, step=5,
            help="‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
        )
        
        ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î = st.slider(
            "‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î (%)",
            min_value=2.0, max_value=10.0, value=4.0, step=0.5,
            help="Real Discount Rate (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ü‡πâ‡∏≠)"
        ) / 100.0
        
        st.divider()
        
        # Toggle ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å
        st.subheader("üí∞ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å (Salvage Value)")
        
        ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å = st.toggle(
            "‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì",
            value=True,
            help="‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å‡∏°‡∏≤‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
        )
        
        if ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å:
            st.info("‚úÖ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å")
        else:
            st.warning("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å")
        
        st.divider()
        
        # Excel Upload Section
        with st.expander("üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (Excel)", expanded=False):
            if OPENPYXL_AVAILABLE:
                # ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template
                template_file = ‡∏™‡∏£‡πâ‡∏≤‡∏á_excel_template()
                if template_file:
                    st.download_button(
                        label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Template Excel",
                        data=template_file,
                        file_name="LCCA_Template.xlsx",
                        mime="application/vnd.openxmlformats-officedocument.spreadsheetml.document",
                        use_container_width=True
                    )
                
                st.caption("üí° ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î template ‚Üí ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Üí ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤")
                
                # Upload File
                uploaded_file = st.file_uploader(
                    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel:",
                    type=['xlsx', 'xls'],
                    help="‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß"
                )
                
                # Process uploaded file
                if uploaded_file is not None:
                    try:
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô = ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å_excel(uploaded_file)
                        
                        if len(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô) > 0:
                            file_hash = hashlib.md5(uploaded_file.getvalue()).hexdigest()
                            
                            # ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                            if st.session_state.get('loaded_excel_hash') != file_hash:
                                ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß = 0
                                for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
                                    if ‡∏ó.‡∏ä‡∏∑‡πà‡∏≠ in ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:
                                        info = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô[‡∏ó.‡∏ä‡∏∑‡πà‡∏≠]
                                        if isinstance(info, dict):
                                            ‡∏ó.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á = info.get('‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô', ‡∏ó.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á)
                                            if info.get('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤') is not None:
                                                ‡∏ó.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = info['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤']
                                            if info.get('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó') is not None:
                                                ‡∏ó.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó = info['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó']
                                        else:
                                            ‡∏ó.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á = float(info)
                                        ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß += 1
                                
                                st.session_state['loaded_excel_hash'] = file_hash
                                # force widget refresh ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô JSON load
                                st.session_state['json_version'] = st.session_state.get('json_version', 0) + 1
                                # ‡πÄ‡∏Å‡πá‡∏ö preview ‡πÑ‡∏ß‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á rerun
                                st.session_state['excel_preview'] = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô
                                st.session_state['excel_upload_msg'] = f"‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ({‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß} ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)"
                                st.rerun()
                            else:
                                # ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° ‚Äî ‡πÅ‡∏™‡∏î‡∏á preview ‡∏à‡∏≤‡∏Å session_state
                                st.success(st.session_state.get('excel_upload_msg', f"‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß ({len(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô)} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)"))
                            
                            # ‡πÅ‡∏™‡∏î‡∏á preview ‡πÄ‡∏™‡∏°‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            if st.session_state.get('excel_preview'):
                                with st.expander("üëÄ ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î", expanded=True):
                                    for ‡∏ä‡∏∑‡πà‡∏≠, ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• in st.session_state['excel_preview'].items():
                                        if isinstance(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, dict):
                                            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.get('‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô', 0)
                                            ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.get('‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤')
                                            ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•.get('‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó')
                                            info_parts = [f"{‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô:,.0f} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°."]
                                            if ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:
                                                info_parts.append(f"‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó}")
                                            if ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤:
                                                info_parts.append(f"‡∏´‡∏ô‡∏≤: {‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤:.1f} ‡∏ã‡∏°.")
                                            st.write(f"‚Ä¢ **{‡∏ä‡∏∑‡πà‡∏≠}**: {', '.join(info_parts)}")
                                        else:
                                            st.write(f"‚Ä¢ **{‡∏ä‡∏∑‡πà‡∏≠}**: {float(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•):,.0f} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.")
                        else:
                            st.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå")
                    
                    except Exception as e:
                        st.error(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {str(e)}")
            else:
                st.warning("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á openpyxl: `pip install openpyxl`")
        
        st.divider()
        
        # ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)
        st.subheader("üìê ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£")
        
        # ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏à‡∏≤‡∏Å session_state
        if '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°' not in st.session_state:
            st.session_state['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°'] = 10000.0
        
        ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏° = st.number_input(
            "‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏£.‡∏°.)",
            min_value=100.0,
            max_value=1000000.0,
            value=st.session_state['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°'],
            step=1000.0,
            help="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß Apply ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
        )
        
        # Auto-apply ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
        if ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏° != st.session_state['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°']:
            st.session_state['‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°'] = ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°
            for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
                ‡∏ó.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà = ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°
            st.rerun()
        
        st.caption(f"‚úÖ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: {‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°:,.0f} ‡∏ï‡∏£.‡∏°. (‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)")
        
        st.divider()
        
        st.subheader("üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß")
        ‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î = st.slider(
            "‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î (¬±%)",
            min_value=1.0, max_value=4.0, value=2.0, step=0.5
        ) / 100.0
        
        st.divider()
        
        # === ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ===
        with st.expander("üíæ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î)", expanded=False):
            # Export JSON
            col_save1, col_save2 = st.columns(2)
            
            with col_save1:
                # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON
                project_data = {
                    '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£': st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£,
                    '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å': [‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å_‡πÄ‡∏õ‡πá‡∏ô_dict(‡∏ó) for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î],
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å': datetime.now().strftime('%Y-%m-%d %H:%M:%S')
                }
                
                json_str = json.dumps(project_data, ensure_ascii=False, indent=2)
                
                st.download_button(
                    label="üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£",
                    data=json_str,
                    file_name=f"LCCA_{st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£}_{datetime.now().strftime('%Y%m%d')}.json",
                    mime="application/json",
                    use_container_width=True,
                    help="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå JSON"
                )
            
            with col_save2:
                # Reset button ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏î 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏û‡∏•‡∏≤‡∏î
                if not st.session_state.get('confirm_reset', False):
                    if st.button("üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï", use_container_width=True, help="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô"):
                        st.session_state['confirm_reset'] = True
                        st.rerun()
                else:
                    st.warning("‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï?")
                    col_yes, col_no = st.columns(2)
                    with col_yes:
                        if st.button("‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô", use_container_width=True, type="primary"):
                            st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô()
                            st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ = "‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á"
                            st.session_state['confirm_reset'] = False
                            st.session_state['json_version'] = st.session_state.get('json_version', 0) + 1
                            st.session_state.pop('loaded_json_hash', None)
                            st.session_state.pop('json_load_msg', None)
                            st.session_state.pop('uploaded_cost_data', None)
                            st.session_state.pop('loaded_excel_hash', None)
                            st.session_state.pop('excel_preview', None)
                            st.session_state.pop('excel_upload_msg', None)
                            st.rerun()
                    with col_no:
                        if st.button("‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å", use_container_width=True):
                            st.session_state['confirm_reset'] = False
                            st.rerun()
            
            # Import JSON
            uploaded_json = st.file_uploader(
                "üìÇ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ",
                type=['json'],
                help="‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå .json ‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ",
                key="json_uploader"
            )
            
            if uploaded_json is not None:
                try:
                    # ‚îÄ‚îÄ Bug Fix: ‡πÉ‡∏ä‡πâ hash ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô load ‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å rerun ‚îÄ‚îÄ
                    file_hash = hashlib.md5(uploaded_json.getvalue()).hexdigest()
                    
                    if st.session_state.get('loaded_json_hash') != file_hash:
                        data = json.loads(uploaded_json.getvalue().decode('utf-8'))
                        
                        # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        if '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' not in data:
                            st.error("‚ùå ‡πÑ‡∏ü‡∏•‡πå JSON ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'")
                        else:
                            st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î = [dict_‡πÄ‡∏õ‡πá‡∏ô_‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å(d) for d in data['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å']]
                            
                            if '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£' in data:
                                st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ = data['‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£']
                                # widget ‡πÉ‡∏ä‡πâ value=session_state ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏á rerun
                            
                            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å = data.get('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö')
                            # ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å hash ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô load ‡∏ã‡πâ‡∏≥
                            st.session_state['loaded_json_hash'] = file_hash
                            st.session_state['json_load_msg'] = f"‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ {‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å})"
                            # ‡πÄ‡∏û‡∏¥‡πà‡∏° version ‚Üí force widget ‡∏ó‡∏∏‡∏Å‡∏ï‡∏±‡∏ß‡πÉ‡∏ô Tab 1 ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà
                            st.session_state['json_version'] = st.session_state.get('json_version', 0) + 1
                            st.rerun()
                    else:
                        # ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏´‡∏•‡∏±‡∏á rerun
                        if st.session_state.get('json_load_msg'):
                            st.success(st.session_state['json_load_msg'])
                        
                except json.JSONDecodeError:
                    st.error("‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á")
                except Exception as e:
                    st.error(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {str(e)}")
                    st.info("üí° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ")
    
    # ==========================================================================
    # ‡πÅ‡∏ó‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å
    # ==========================================================================
    tab1, tab2, tab3, tab4, tab5 = st.tabs([
        "üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
        "üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå",
        "üí∞ ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î",
        "üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß",
        "‚ÑπÔ∏è ‡∏ó‡∏§‡∏©‡∏é‡∏µ LCCA"
    ])
    
    # ==========================================================================
    # ‡πÅ‡∏ó‡πá‡∏ö 1: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    # ==========================================================================
    with tab1:
        st.header("üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á")
        
        st.info("""
        üí° **‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:** 
        - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ ‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        - ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
        - ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÅ‡∏•‡∏∞‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ
        """)
        
        # ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        v = st.session_state.get('json_version', 0)  # version ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö force refresh widget
        for i, ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å in enumerate(st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î):
            with st.expander(f"{'‚úÖ' if ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô else '‚ùå'} ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà {i+1}: {‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠}", expanded=(i==0)):
                
                # ‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô‡∏™‡∏∏‡∏î: ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
                col_enable = st.columns([3, 1])
                with col_enable[1]:
                    ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ = st.checkbox(
                        "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
                        value=‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô,
                        key=f"enable_{i}_v{v}"
                    )
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô = ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ
                
                st.markdown("---")
                
                # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å
                st.subheader("üèóÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å")
                col1, col2, col3 = st.columns(3)
                
                with col1:
                    ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà = st.text_input(
                        "‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
                        value=‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠,
                        key=f"name_{i}_v{v}"
                    )
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ä‡∏∑‡πà‡∏≠ = ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
                
                with col2:
                    ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏´‡∏°‡πà = st.selectbox(
                        "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á",
                        options=["Flexible", "JPCP", "JRCP", "CRCP"],
                        index=["Flexible", "JPCP", "JRCP", "CRCP"].index(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó) if ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó in ["Flexible", "JPCP", "JRCP", "CRCP"] else 0,
                        key=f"type_{i}_v{v}"
                    )
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó = ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏´‡∏°‡πà
                
                with col3:
                    # ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (JSON load ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß)
                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô = getattr(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å, '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤', 0.0)
                    if ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô == 0.0:
                        defaults = {'Flexible': 15.0, 'JPCP': 30.0, 'JRCP': 25.0, 'CRCP': 25.0}
                        ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô = defaults.get(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó, 25.0)
                    
                    ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà = st.number_input(
                        "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡∏ã‡∏°.)",
                        min_value=0.0,
                        max_value=100.0,
                        value=float(‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô),
                        step=1.0,
                        key=f"thickness_{i}_v{v}"
                    )
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ = ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà
                
                col4, col5, col6 = st.columns(3)
                
                with col4:
                    # ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏≤‡∏Å ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (JSON load ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß)
                    ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡∏°‡πà = st.number_input(
                        "‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)",
                        min_value=0.0,
                        max_value=10000.0,
                        value=float(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á),
                        step=100.0,
                        key=f"cost_{i}_v{v}"
                    )
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á = ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡∏°‡πà
                
                with col5:
                    # ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö read-only (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà Sidebar ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
                    st.metric(
                        label="‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏£.‡∏°.)",
                        value=f"{‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:,.0f}",
                        help="‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà Sidebar ‚Üí ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"
                    )
                
                with col6:
                    # ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î Toggle
                    if ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å:
                        ‡∏ã‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà = st.number_input(
                            "‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å (%)",
                            min_value=0.0,
                            max_value=50.0,
                            value=float(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å),
                            step=5.0,
                            key=f"salvage_{i}_v{v}"
                        )
                        ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å = ‡∏ã‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà
                    else:
                        # ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î Toggle ‚Üí ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á ‡πÅ‡∏ï‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ
                        st.info("‚ö†Ô∏è ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å")
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏ß‡∏°
                st.metric(
                    "üí∞ ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏ß‡∏°",
                    f"{‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á * ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:,.0f} ‡∏ö‡∏≤‡∏ó"
                )
                
                st.markdown("---")
                
                # ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤
                st.subheader("üîß ‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤")
                
                # ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
                col_h1, col_h2, col_h3, col_h4, col_h5 = st.columns([3, 2, 1, 1, 0.5])
                with col_h1:
                    st.markdown("**‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°**")
                with col_h2:
                    st.markdown("**‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)**")
                with col_h3:
                    st.markdown("**‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô**")
                with col_h4:
                    st.markdown("**‡∏ó‡∏∏‡∏Å‡πÜ (‡∏õ‡∏µ)**")
                with col_h5:
                    st.markdown("**‡∏•‡∏ö**")
                
                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö_maint = []
                for j, ‡∏ö‡∏≥‡∏£‡∏∏‡∏á in enumerate(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤):
                    col_m1, col_m2, col_m3, col_m4, col_m5 = st.columns([3, 2, 1, 1, 0.5])
                    
                    with col_m1:
                        ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° = st.text_input(
                            "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
                            value=‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                            key=f"maint_name_{i}_{j}_v{v}",
                            label_visibility="collapsed"
                        )
                    
                    with col_m2:
                        ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ = st.number_input(
                            "‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.",
                            min_value=0.0,
                            value=float(‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢),
                            step=5.0,
                            key=f"maint_cost_{i}_{j}_v{v}",
                            label_visibility="collapsed"
                        )
                    
                    with col_m3:
                        ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô = st.number_input(
                            "‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°",
                            min_value=1,
                            max_value=50,
                            value=int(‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô),
                            key=f"maint_year_{i}_{j}_v{v}",
                            label_visibility="collapsed"
                        )
                    
                    with col_m4:
                        ‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà = st.number_input(
                            "‡∏ó‡∏∏‡∏Å‡πÜ (‡∏õ‡∏µ)",
                            min_value=0,
                            max_value=20,
                            value=int(‡∏ö‡∏≥‡∏£‡∏∏‡∏á.‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà),
                            key=f"maint_freq_{i}_{j}_v{v}",
                            label_visibility="collapsed"
                        )
                    
                    with col_m5:
                        if st.button("üóëÔ∏è", key=f"del_maint_{i}_{j}_v{v}", help="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ"):
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö_maint.append(j)
                
                # ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                for idx in sorted(‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö_maint, reverse=True):
                    if len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤) > 1:
                        ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤.pop(idx)
                        st.rerun()
                
                # ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤
                if st.button(f"‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤", key=f"add_maint_{i}_v{v}"):
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤.append(
                        ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤("‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà", 50.0, ‡∏õ‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô=5, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà=5)
                    )
                    st.rerun()
                
                st.markdown("---")
                
                # ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û
                st.subheader("üöÄ ‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û")
                
                # ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
                col_rh1, col_rh2, col_rh3, col_rh4 = st.columns([4, 2, 1, 0.5])
                with col_rh1:
                    st.markdown("**‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°**")
                with col_rh2:
                    st.markdown("**‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)**")
                with col_rh3:
                    st.markdown("**‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£**")
                with col_rh4:
                    st.markdown("**‡∏•‡∏ö**")
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û
                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö_rehab = []
                
                # ‡∏™‡∏£‡πâ‡∏≤‡∏á key version ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö force update
                if f'rehab_update_version_{i}' not in st.session_state:
                    st.session_state[f'rehab_update_version_{i}'] = 0
                
                for k, ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π in enumerate(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û):
                    col_r1, col_r2, col_r3, col_r4 = st.columns([4, 2, 1, 0.5])
                    
                    with col_r1:
                        ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Å‡πà‡∏≤ = ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                        rv = st.session_state[f'rehab_update_version_{i}']
                        ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà = st.text_input(
                            "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
                            value=‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°,
                            key=f"rehab_name_{i}_{k}_v{v}_{rv}",
                            label_visibility="collapsed"
                        )
                        
                        if ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà != ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏Å‡πà‡∏≤:
                            ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° = ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
                            if "‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà" in ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà or ("‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á" in ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà and "‡πÉ‡∏´‡∏°‡πà" in ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà):
                                ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ = float(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á)
                                st.session_state[f'rehab_update_version_{i}'] += 1
                                st.rerun()
                        else:
                            ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° = ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà
                    
                    with col_r2:
                        ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π = float(‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢)
                        if "‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà" in ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° or ("‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á" in ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° and "‡πÉ‡∏´‡∏°‡πà" in ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°):
                            ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π = float(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á)
                        
                        ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ = st.number_input(
                            "‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.",
                            min_value=0.0,
                            value=‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π,
                            step=10.0,
                            key=f"rehab_cost_{i}_{k}_v{v}_{rv}",
                            label_visibility="collapsed",
                            help="üí° ‡∏û‡∏¥‡∏°‡∏û‡πå '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà' ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Enter ‚Üí ‡∏î‡∏∂‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
                        )
                    
                    with col_r3:
                        ‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ = st.number_input(
                            "‡∏õ‡∏µ‡∏ó‡∏µ‡πà",
                            min_value=1,
                            max_value=50,
                            value=int(‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£),
                            key=f"rehab_year_{i}_{k}_v{v}",
                            label_visibility="collapsed"
                        )
                    
                    with col_r4:
                        if st.button("üóëÔ∏è", key=f"del_rehab_{i}_{k}_v{v}", help="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ"):
                            ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö_rehab.append(k)
                
                # ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                for idx in sorted(‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö_rehab, reverse=True):
                    if len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û) > 1:
                        ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û.pop(idx)
                        st.rerun()
                
                # ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û
                if st.button(f"‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û", key=f"add_rehab_{i}_v{v}"):
                    # ‡∏´‡∏≤‡∏õ‡∏µ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
                    ‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î = max([‡∏ü.‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ for ‡∏ü in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û]) if ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û else 10
                    ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å.‡πÅ‡∏ú‡∏ô‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û.append(
                        ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û("Overlay AC 50 ‡∏°‡∏°.", 450.0, ‡∏õ‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=‡∏õ‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î + 9)
                    )
                    st.rerun()
        
        st.divider()
        
        # ‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ = [‡∏ó for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î if ‡∏ó.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô]
        st.info(f"üìã ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: **{len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ)}** ‡∏à‡∏≤‡∏Å {len(st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)} ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å")
    
    # ==========================================================================
    # ‡πÅ‡∏ó‡πá‡∏ö 2: ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
    # ==========================================================================
    with tab2:
        st.header("üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA")
        
        # ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
        st.subheader(f"üìã ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: {st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£}")
        
        # ‡πÅ‡∏™‡∏î‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
        col1, col2, col3 = st.columns(3)
        with col1:
            st.info(f"üìÖ ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: **{‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå} ‡∏õ‡∏µ**")
        with col2:
            st.info(f"üìâ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î: **{‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î*100:.1f}%**")
        with col3:
            ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ = [‡∏ó for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î if ‡∏ó.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô]
            st.info(f"üõ£Ô∏è ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: **{len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ)}**")
        
        if len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ) == 0:
            st.warning("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'")
        else:
            # ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
            with st.spinner("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì LCCA..."):
                ‡∏™‡∏£‡∏∏‡∏õ, ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î = ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå_LCCA(st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å)
            
            st.subheader("üèÜ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö")
            
            # ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            ‡∏™‡∏£‡∏∏‡∏õ_display = ‡∏™‡∏£‡∏∏‡∏õ[['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤_‡∏ã‡∏°', '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà_‡∏ï‡∏£‡∏°', 
                                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á_‡∏ï‡∏£‡∏°', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°', 
                                '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏£‡∏°_‡∏ï‡πà‡∏≠‡∏õ‡∏µ']].copy()
            ‡∏™‡∏£‡∏∏‡∏õ_display.columns = ['‡∏•‡∏≥‡∏î‡∏±‡∏ö', '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡∏ã‡∏°.)', '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏£.‡∏°.)',
                                   '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)', 
                                   'EAC (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°./‡∏õ‡∏µ)']
            
            def highlight_best(row):
                if row['‡∏•‡∏≥‡∏î‡∏±‡∏ö'] == 1:
                    return ['background-color: #90EE90'] * len(row)
                return [''] * len(row)
            
            st.dataframe(
                ‡∏™‡∏£‡∏∏‡∏õ_display.style.apply(highlight_best, axis=1).format({
                    '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ (‡∏ã‡∏°.)': '{:,.1f}',
                    '‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡∏ï‡∏£.‡∏°.)': '{:,.0f}',
                    '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°.)': '{:,.0f}',
                    '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)': '{:,.0f}',
                    'EAC (‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ)': '{:,.0f}',
                    '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°./‡∏õ‡∏µ)': '{:,.2f}'
                }),
                use_container_width=True,
                hide_index=True
            )
            
            # ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞
            ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ = ‡∏™‡∏£‡∏∏‡∏õ.iloc[0]
            st.success(f"""
            ### ‚≠ê ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: **{‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å']}**
            - ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°: **{‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']:,.0f} ‡∏ö‡∏≤‡∏ó**
            - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ: **{‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ']:,.0f} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ**
            - ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏õ‡∏µ: **{‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏ï‡∏£‡∏°_‡∏ï‡πà‡∏≠‡∏õ‡∏µ']:,.2f} ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏£.‡∏°./‡∏õ‡∏µ**
            """)
            
            # ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô
            if len(‡∏™‡∏£‡∏∏‡∏õ) > 1:
                st.subheader("üí° ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∑‡πà‡∏ô")
                for idx in range(1, len(‡∏™‡∏£‡∏∏‡∏õ)):
                    ‡∏≠‡∏∑‡πà‡∏ô = ‡∏™‡∏£‡∏∏‡∏õ.iloc[idx]
                    ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á = ‡∏≠‡∏∑‡πà‡∏ô['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°'] - ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']
                    ‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ = (‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á / ‡∏≠‡∏∑‡πà‡∏ô['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°']) * 100
                    st.info(f"üìä vs {‡∏≠‡∏∑‡πà‡∏ô['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å']}: ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î **{‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á:,.0f} ‡∏ö‡∏≤‡∏ó** ({‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞:.1f}%)")
            
            st.divider()
            
            # ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
            st.subheader("üìä ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô")
            
            fig_bar = go.Figure()
            
            ‡∏™‡∏µ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö = {
                'PW_‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á': ('#1f77b4', '‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô'),
                'PW_‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤': ('#ff7f0e', '‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤'),
                'PW_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û': ('#2ca02c', '‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û')
            }
            
            for ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö, (‡∏™‡∏µ, ‡∏ä‡∏∑‡πà‡∏≠) in ‡∏™‡∏µ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö.items():
                fig_bar.add_trace(go.Bar(
                    name=‡∏ä‡∏∑‡πà‡∏≠,
                    x=‡∏™‡∏£‡∏∏‡∏õ['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'],
                    y=‡∏™‡∏£‡∏∏‡∏õ[‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö],
                    marker_color=‡∏™‡∏µ
                ))
            
            fig_bar.update_layout(
                barmode='stack',
                title='‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)',
                yaxis_title='‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)',
                xaxis_title='‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á',
                legend_title='‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö',
                height=500
            )
            
            st.plotly_chart(fig_bar, use_container_width=True)
            
            # ‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°
            st.subheader("ü•ß ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å")
            
            cols = st.columns(min(len(‡∏™‡∏£‡∏∏‡∏õ), 4))
            for idx, (_, row) in enumerate(‡∏™‡∏£‡∏∏‡∏õ.iterrows()):
                with cols[idx % len(cols)]:
                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏á‡∏Å‡∏•‡∏° = {
                        '‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö': ['‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á', '‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤', '‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û'],
                        '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤': [row['PW_‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á'], row['PW_‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤'], row['PW_‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π‡∏™‡∏†‡∏≤‡∏û']]
                    }
                    fig_pie = px.pie(
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏á‡∏Å‡∏•‡∏°, 
                        values='‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤', 
                        names='‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö',
                        title=row['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'],
                        color_discrete_sequence=px.colors.qualitative.Set2
                    )
                    fig_pie.update_layout(height=350)
                    st.plotly_chart(fig_pie, use_container_width=True)
            
            # ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
            st.divider()
            st.subheader("üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô")
            
            col_export1, col_export2 = st.columns(2)
            
            with col_export1:
                if DOCX_AVAILABLE:
                    word_file = ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_Word(
                        ‡∏™‡∏£‡∏∏‡∏õ, ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î,
                        st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î,
                        st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
                    )
                    st.download_button(
                        label="üìù ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Word",
                        data=word_file,
                        file_name=f"LCCA_{st.session_state.‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£}_{datetime.now().strftime('%Y%m%d_%H%M')}.docx",
                        mime="application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                        use_container_width=True
                    )
                else:
                    st.warning("‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á python-docx: `pip install python-docx`")
            
            with col_export2:
                csv_summary = ‡∏™‡∏£‡∏∏‡∏õ.to_csv(index=False).encode('utf-8-sig')
                st.download_button(
                    label="üìä ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏£‡∏∏‡∏õ CSV",
                    data=csv_summary,
                    file_name=f"LCCA_Summary_{datetime.now().strftime('%Y%m%d_%H%M')}.csv",
                    mime="text/csv",
                    use_container_width=True
                )
    
    # ==========================================================================
    # ‡πÅ‡∏ó‡πá‡∏ö 3: ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î
    # ==========================================================================
    with tab3:
        st.header("üí∞ ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏£‡∏≤‡∏¢‡∏õ‡∏µ")
        
        ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ = [‡∏ó for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î if ‡∏ó.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô]
        
        if len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ) == 0:
            st.warning("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å")
        else:
            with st.spinner("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î..."):
                ‡∏™‡∏£‡∏∏‡∏õ, ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î = ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå_LCCA(st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å)
            
            ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å = st.selectbox(
                "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:",
                options=[‡∏ó.‡∏ä‡∏∑‡πà‡∏≠ for ‡∏ó in ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ]
            )
            
            if ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å in ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î:
                cf_table = ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î[‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å].copy()
                
                # ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏£‡∏∏‡∏õ
                col1, col2, col3 = st.columns(3)
                with col1:
                    st.metric("‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ‡∏£‡∏ß‡∏°", f"{cf_table['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ'].sum():,.0f} ‡∏ö‡∏≤‡∏ó")
                with col2:
                    st.metric("‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏£‡∏ß‡∏°", f"{cf_table['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum():,.0f} ‡∏ö‡∏≤‡∏ó")
                with col3:
                    eac = ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ(cf_table['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].sum(), ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå)
                    st.metric("EAC", f"{eac:,.0f} ‡∏ö‡∏≤‡∏ó/‡∏õ‡∏µ")
                
                st.divider()
                
                # ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                cf_display = cf_table.copy()
                cf_display['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢'] = cf_display['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢'].apply(lambda x: f"{x:,.2f}")
                cf_display['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ'] = cf_display['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ'].apply(lambda x: f"{x:,.0f}")
                cf_display['‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW'] = cf_display['‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì_PW'].apply(lambda x: f"{x:.4f}")
                cf_display['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'] = cf_display['‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô'].apply(lambda x: f"{x:,.0f}")
                cf_display.columns = ['‡∏õ‡∏µ', '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°', '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô/‡∏´‡∏ô‡πà‡∏ß‡∏¢', '‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ (‡∏ö‡∏≤‡∏ó)', '‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì PW', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)']
                
                st.dataframe(cf_display, use_container_width=True, hide_index=True, height=500)
                
                # ‡∏Å‡∏£‡∏≤‡∏ü Timeline
                st.subheader("üìÖ Timeline ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î")
                
                cf_plot = cf_table[cf_table['‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ'] > 0].copy()
                
                fig_timeline = px.scatter(
                    cf_plot,
                    x='‡∏õ‡∏µ',
                    y='‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                    size='‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏µ',
                    color='‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó',
                    hover_name='‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°',
                    title=f'Timeline ‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î - {‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å}',
                    labels={'‡∏õ‡∏µ': '‡∏õ‡∏µ', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)'}
                )
                fig_timeline.update_layout(height=400)
                st.plotly_chart(fig_timeline, use_container_width=True)
                
                # ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV
                st.divider()
                csv = cf_table.to_csv(index=False).encode('utf-8-sig')
                st.download_button(
                    label="‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (CSV)",
                    data=csv,
                    file_name=f"cashflow_{‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å}.csv",
                    mime="text/csv"
                )
    
    # ==========================================================================
    # ‡πÅ‡∏ó‡πá‡∏ö 4: ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß
    # ==========================================================================
    with tab4:
        st.header("üìà ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß (Sensitivity Analysis)")
        
        ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ = [‡∏ó for ‡∏ó in st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î if ‡∏ó.‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô]
        
        if len(‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ) == 0:
            st.warning("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å")
        else:
            st.subheader("1Ô∏è‚É£ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß‡∏ï‡πà‡∏≠‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î")
            
            with st.spinner("‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß..."):
                ‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, pivot_‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î = ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏ß_‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î(
                    st.session_state.‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå, ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î, ‡∏£‡∏ß‡∏°‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏ã‡∏≤‡∏Å
                )
            
            if len(‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î) > 0:
                # ‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏™‡πâ‡∏ô
                fig_sens = px.line(
                    ‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î,
                    x='‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î',
                    y='‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                    color='‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å',
                    markers=True,
                    title='‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡∏≠‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î‡∏ï‡πà‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
                    labels={'‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î': '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)'}
                )
                fig_sens.update_layout(height=500)
                fig_sens.update_xaxes(tickformat='.1%')
                st.plotly_chart(fig_sens, use_container_width=True)
                
                # ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Pivot
                st.markdown("**‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î (‡∏ö‡∏≤‡∏ó):**")
                pivot_display = pivot_‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î.copy()
                for col in pivot_display.columns:
                    pivot_display[col] = pivot_display[col].apply(lambda x: f"{x:,.0f}")
                st.dataframe(pivot_display, use_container_width=True)
                
                # ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î = ‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î['‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î'].min()
                ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î = ‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î['‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î'].max()
                
                ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏ï‡πà‡∏≥ = ‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î[‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î['‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î'] == ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î].nsmallest(1, '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô')['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'].values[0]
                ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏™‡∏π‡∏á = ‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î[‡∏ú‡∏•‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î['‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î'] == ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î].nsmallest(1, '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô')['‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å'].values[0]
                
                if ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏ï‡πà‡∏≥ == ‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏™‡∏π‡∏á:
                    st.success(f"‚úÖ **{‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏ï‡πà‡∏≥}** ‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡∏•‡∏î (Robust Decision)")
                else:
                    st.warning(f"‚ö†Ô∏è ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á: {‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏ï‡πà‡∏≥} (‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ï‡πà‡∏≥) vs {‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏™‡∏π‡∏á} (‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡∏π‡∏á)")
    
    # ==========================================================================
    # ‡πÅ‡∏ó‡πá‡∏ö 5: ‡∏ó‡∏§‡∏©‡∏é‡∏µ LCCA
    # ==========================================================================
    with tab5:
        st.header("‚ÑπÔ∏è ‡∏ó‡∏§‡∏©‡∏é‡∏µ Life-Cycle Cost Analysis (LCCA)")
        
        st.markdown("""
        ## 1. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï
        
        | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏° | ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏î‡πà‡∏ô |
        |--------|---------|-----------|
        | **JPCP** | Jointed Plain Concrete Pavement | ‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å ‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏ó‡∏∏‡∏Å 4-6 ‡∏°. |
        | **JRCP** | Jointed Reinforced Concrete Pavement | ‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å ‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏´‡πà‡∏≤‡∏á 8-15 ‡∏°. |
        | **CRCP** | Continuously Reinforced Concrete Pavement | ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏Ç‡∏ß‡∏≤‡∏á |
        
        ## 2. ‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏´‡∏•‡∏±‡∏Å
        
        ### 2.1 ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Present Worth)
        """)
        
        st.latex(r"PW = FV \times (1 + i)^{-n}")
        
        st.markdown("""
        ### 2.2 ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (Equivalent Annual Cost)
        """)
        
        st.latex(r"EAC = PW \times \frac{i(1+i)^N}{(1+i)^N - 1}")
        
        st.markdown("""
        ## 3. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏£‡∏µ‡∏ï
        
        | ‡πÄ‡∏Å‡∏ì‡∏ë‡πå | JPCP | JRCP | CRCP |
        |------|------|------|------|
        | ‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á | ‡∏ï‡πà‡∏≥ | ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á | ‡∏™‡∏π‡∏á |
        | ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏≠‡∏¢‡∏ï‡πà‡∏≠ | 4-6 ‡∏°. | 8-15 ‡∏°. | ‡πÑ‡∏°‡πà‡∏°‡∏µ |
        | ‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÄ‡∏™‡∏£‡∏¥‡∏° | ‡πÑ‡∏°‡πà‡∏°‡∏µ | 0.1-0.25% | 0.6-0.7% |
        | ‡∏Ñ‡πà‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤ | ‡∏™‡∏π‡∏á | ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á | ‡∏ï‡πà‡∏≥ |
        | ‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | 20-30 ‡∏õ‡∏µ | 25-35 ‡∏õ‡∏µ | 30-40 ‡∏õ‡∏µ |
        
        ## 4. ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á
        
        - FHWA-SA-98-079: Life-Cycle Cost Analysis in Pavement Design
        - AASHTO Guide for Design of Pavement Structures
        - NCHRP Report 703: Guide for Pavement-Type Selection
        - ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏£‡∏°‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á
        """)
    
    # ==========================================================================
    # Footer
    # ==========================================================================
    st.divider()
    st.markdown("""
    ---
    **‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå LCCA ‡∏ú‡∏¥‡∏ß‡∏ó‡∏≤‡∏á v2.2** | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏≤‡∏á  
    ‡∏†‡∏≤‡∏Ñ‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÇ‡∏¢‡∏ò‡∏≤ ‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏û‡∏£‡∏∞‡∏à‡∏≠‡∏°‡πÄ‡∏Å‡∏•‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡πÄ‡∏´‡∏ô‡∏∑‡∏≠
    """)


if __name__ == "__main__":
    main()
